window.addEventListener("load",()=>{var e="pk.eyJ1IjoiY2hhdmEtdXRjIiwiYSI6ImNtOTdqdm13cjA4ZGsyaW9rc2g0OGRmdWoifQ.oxLDSCy8_q3xLJNVtDHmDw",o=document.getElementById("map");localStorage.getItem("mapbox-last_layer"),document.querySelectorAll("#offcanvasbody input[type='radio']"),document.querySelectorAll("#offcanvasbody label");const a=document.querySelector("#form_route");a.querySelector("#origen"),a.querySelector("#destino");let t="#000",n=!1;const l=document.querySelector("#infoLateral"),r=bootstrap.Offcanvas.getInstance(l)||new bootstrap.Offcanvas(l);mapboxgl.accessToken=e;const i=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[-100.93655,25.55701],zoom:16,maxZoom:20,minZoom:15,maxBounds:[[-100.9736,25.5142],[-100.9117,25.5735]]});if($("#switchTheme").click(function(){$("#switchTheme").is(":checked")?(t="#000",setMapStyle("streets-v12"),updateLabelsAndInputs("streets-v12")):(t="#fff",setMapStyle("dark-v11"),updateLabelsAndInputs("dark-v11"))}),o.classList.contains("map_editing")){n=!0;var s={black:"#000000",negro:"#000000",white:"#FFFFFF",blanco:"#FFFFFF",red:"#FF0000",rojo:"#FF0000",green:"#008000",verde:"#008000",blue:"#0000FF",azul:"#0000FF",yellow:"#FFFF00",amarillo:"#FFFF00",cyan:"#00FFFF",cian:"#00FFFF",magenta:"#FF00FF",magenta:"#FF00FF",gray:"#808080",gris:"#808080",darkgray:"#A9A9A9","gris oscuro":"#A9A9A9",lightgray:"#D3D3D3","gris claro":"#D3D3D3",dimgray:"#696969","gris tenue":"#696969",slategray:"#708090","gris pizarra":"#708090",cornflowerblue:"#6495ED","azul aciano":"#6495ED",darkred:"#8B0000","rojo oscuro":"#8B0000",lightgreen:"#90EE90","verde claro":"#90EE90",darkblue:"#00008B","azul oscuro":"#00008B",gold:"#FFD700",oro:"#FFD700",silver:"#C0C0C0",plata:"#C0C0C0",pink:"#FFC0CB",rosa:"#FFC0CB",orange:"#FFA500",naranja:"#FFA500",purple:"#800080",morado:"#800080",brown:"#A52A2A","marrón":"#A52A2A",violet:"#EE82EE",violeta:"#EE82EE",turquoise:"#40E0D0",turquesa:"#40E0D0",indigo:"#4B0082","índigo":"#4B0082",khaki:"#F0E68C",caqui:"#F0E68C",maroon:"#800000",granate:"#800000",olive:"#808000",oliva:"#808000",navy:"#000080","azul marino":"#000080",teal:"#008080","verde azulado":"#008080",salmon:"#FA8072","salmón":"#FA8072",goldenrod:"#DAA520","vara de oro":"#DAA520",chocolate:"#D2691E",chocolate:"#D2691E",coral:"#FF7F50",coral:"#FF7F50",aquamarine:"#7FFFD4",aguamarina:"#7FFFD4",fuchsia:"#FF00FF",fucsia:"#FF00FF",lavender:"#E6E6FA",lavanda:"#E6E6FA",beige:"#F5F5DC",beis:"#F5F5DC",azure:"#F0FFFF","cian claro":"#F0FFFF",ivory:"#FFFFF0",marfil:"#FFFFF0",linen:"#FAF0E6",lino:"#FAF0E6",plum:"#DDA0DD",ciruela:"#DDA0DD",orchid:"#DA70D6","orquídea":"#DA70D6",mintcream:"#F5FFFA","crema de menta":"#F5FFFA",seashell:"#FFF5EE",concha:"#FFF5EE",honeydew:"#F0FFF0","rocío de miel":"#F0FFF0",snow:"#FFFAFA",nieve:"#FFFAFA",blanchedalmond:"#FFEBCD","almendra blanqueada":"#FFEBCD",antiquewhite:"#FAEBD7","blanco antiguo":"#FAEBD7",skyblue:"#87CEEB","cielo azul":"#87CEEB",peachpuff:"#FFDAB9",durazno:"#FFDAB9",navajowhite:"#FFDEAD","blanco navajo":"#FFDEAD",wheat:"#F5DEB3",trigo:"#F5DEB3",peru:"#CD853F","perú":"#CD853F",tomato:"#FF6347",tomate:"#FF6347",lightblue:"#ADD8E6","azul claro":"#ADD8E6",lime:"#00FF00",lima:"#00FF00"};const e=$("#colorsList");for(let o in s)e.append(`<option value="${o}">`);function c(e){return s[e.toLowerCase()]||e}function d(){const e=$("[data-colorName]").val(),o=c(e);$("#colorHex").val(o),$("[data-colorPicker]").val(o)}$("[data-colorName]").on("input",d),$("[data-colorPicker]").on("input",function(){const e=$("[data-colorPicker]").val();$("[data-colorName]").addClass("active").val(e),$("#colorHex").val(e)}),$("#btnPoligon").on("click",function(){$("#esquinasPoligono").slideDown("slow")});const o=document.getElementById("btnPoligon"),a=document.getElementById("btnPoligonCancel"),v=["esquina1","esquina2","esquina3","esquina4"],E=["tomato","#3b71ca","lime","#d29c15"];let D=4,h=[],L=[],A=null,k=!1;function F(e){if(L.length<4){const o=E[L.length],a=new mapboxgl.Marker({color:o,draggable:!0}).setLngLat(e.lngLat).addTo(i).on("dragend",g);h.push(a),L.push(e.lngLat),document.getElementById(v[L.length-1]).classList.add("active"),document.getElementById(v[L.length-1]).value=`${e.lngLat.lng}, ${e.lngLat.lat}`}4===L.length&&(i.off("contextmenu",F),m(),o.classList.add("bg_red-blue"),o.classList.remove("bg_purple-blue"),o.innerHTML='Dibujar de nuevo <i class="fa-solid fa-trash-can ms-1"></i>',k=!0,$("#btnPoligonCancel").slideUp())}function u(){h.forEach(e=>e.remove()),h=[],L=[],k?(o.classList.remove("btn_detail","bg_red-blue"),o.classList.add("bg_purple-blue"),o.innerHTML='Borrar marcadores <i class="fa-solid fa-trash-can ms-1"></i>'):""===k&&(o.classList.remove("bg_purple-blue","bg_red-blue"),o.classList.add("btn_detail"),o.innerHTML='Dibujar Poligono <i class="fa-solid fa-draw-polygon ms-1"></i>'),A&&(i.getLayer(A.id+"_label")&&i.removeLayer(A.id+"_label"),i.getLayer(A.id)&&i.removeLayer(A.id),i.getSource(A.id)&&i.removeSource(A.id)),k=!1}function m(){const e=document.getElementById("nombreEdificio").value||"Nuevo Lugar",o=document.getElementById("colorHex").value||"#808080",a=[L[0].toArray(),L[1].toArray(),L[2].toArray(),L[3].toArray(),L[0].toArray()];i.getLayer("polygon_label")&&i.removeLayer("polygon_label"),i.getLayer("polygon")&&i.removeLayer("polygon"),i.getSource("polygon")&&i.removeSource("polygon");const n="polygon";i.addSource(n,{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[a]}}}),i.addLayer({id:n,type:"fill",source:n,layout:{},paint:{"fill-color":o,"fill-opacity":.5}}),i.addLayer({id:n+"_label",type:"symbol",source:n,layout:{"text-field":e,"text-size":14,"text-anchor":"center"},paint:{"text-color":t}}),A={id:n}}function g(){L=h.map(e=>e.getLngLat()),v.forEach((e,o)=>{document.getElementById(e).value=`${L[o].lng}, ${L[o].lat}`}),m()}function p(){D--,D>0?document.getElementById("poligonClicks").textContent=D:(i.off("contextmenu",p),setTimeout(()=>{$("#controlsIndic").removeClass("show"),D=4,document.getElementById("poligonClicks").textContent=D},2e3))}o.addEventListener("click",()=>{k=!0,n=!1,u(),$("#controlsIndic .card-header h6").html('<i class="fa-solid fa-draw-polygon me-1"></i>Dibujar Poligono:'),$("#controlsIndic .card-body p").html('Da <strong id="poligonClicks">4</strong> cliks derechos en el mapa... <br> Dibuja el poligono en sentido <u>Horario</u> <i class="fa-solid fa-arrow-rotate-right ms-1"></i>'),$("#controlsIndic").addClass("show"),i.on("contextmenu",p),i.on("contextmenu",F),$("#btnPoligonCancel").slideDown(),window.innerWidth<=800&&setTimeout(()=>{l.classList.contains("show")&&r.hide()},1e3)}),a.addEventListener("click",()=>{k="",u(),i.off("contextmenu",F),i.off("contextmenu",p),$("#controlsIndic").removeClass("show"),$("#btnPoligonCancel").slideUp(),$("#esquinasPoligono").slideUp("fast")});const C=document.getElementById("inputBtnDoor"),w=document.getElementById("puertaCordsEdificio");var y;let B=!0;function b(e){y&&y.remove(),y=new mapboxgl.Marker({color:"purple",draggable:!0}).setLngLat(e.lngLat).addTo(i).on("dragend",f),w.classList.add("active"),w.value=`${e.lngLat.lng}, ${e.lngLat.lat}`,C.classList.remove("bg_purple-blue"),C.classList.add("btn_detail"),B=!0,i.off("contextmenu",b),setTimeout(()=>{$("#controlsIndic").removeClass("show")},2e3)}function f(e){const o=y.getLngLat();w.value=`${o.lng}, ${o.lat}`}C.addEventListener("click",()=>{n=!1,B&&(L.length>4&&a.click(),C.classList.add("bg_purple-blue"),C.classList.remove("btn_detail"),i.on("contextmenu",b),$("#controlsIndic .card-header h6").html('<i class="fa-solid fa-location-dot me-1"></i>Punto de Entrada:'),$("#controlsIndic .card-body p").html("Da <strong>1</strong> clik derecho en el mapa... <br> Debe esta ubicada en el <strong>borde</strong>  del poligono y conectada con algun <strong>camino</strong>"),$("#controlsIndic").addClass("show")),B=!1,window.innerWidth<=800&&setTimeout(()=>{l.classList.contains("show")&&r.hide()},1e3)}),$("#checkIsmarker").change(function(){$(this).is(":checked")?($("#sizemarkerdiv").slideDown("fast"),$("[data-notmarker]").slideUp(),$('[for="puertaCordsEdificio"]').text("Ubicacion:")):($("#sizemarkerdiv").slideUp(),$("[data-notmarker]").slideDown(),$('[for="puertaCordsEdificio"]').text("Punto de entrada:"))}),$("#sizemarker").blur(function(){const e=parseFloat($("#sizemarker").attr("max")),o=parseFloat($("#sizemarker").attr("min"));let a=parseFloat($("#sizemarker").val());a>e?a=e:a<o&&(a=o),$("#sizemarker").val(a)})}});