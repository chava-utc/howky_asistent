$(document).ready(function(){function a(){const a=u.val(),e=p.val(),t=f.val();a&&e&&t&&s.attr("camera-orbit",`${a}deg ${e}deg ${t}m`)}function e(a){s.attr("src","/static/img/howki-final.glb"),setTimeout(()=>{s.attr("src",a)},100),s.on("load",function(){y=c.length,$("#num_areas").attr("max",y),x.empty(),y>0?($.each(c,function(a,e){x.append($("<option>",{value:e,text:e}))}),l&&$(`#animationsSelect option[value="${l}"]`).attr("selected",!0),$("#modelAreasCont").slideDown()):($("#modelAreasCont").slideUp(),0==y&&x.append("<option hidden selected disabled>No hay animaciones</option>")),v=!1,s[0].play(),h.attr("title","Pausar Animacion").html('<i class="fa-regular fa-circle-pause fs-20"></i>')})}function t(){const a=$(".animationsSelect.selectList");a.empty(),y>1?(a.append("<option hidden selected disabled>Animaciones:</option>"),$.each(c,function(e,t){a.append($("<option>",{value:t,text:t}))})):($("#modelAreasCont").slideUp(),0==y&&a.append("<option hidden selected disabled>No hay animaciones</option>"))}function n(a,e=2){clearTimeout(window.animTimer),s[0].animationName=a,s[0].play(),window.animTimer=setTimeout(()=>{const a=$("#animationsSelect").val();s[0].animationName=a||l,s[0].play(),v=!1,h.attr("title","Pausar Animacion").html('<i class="fa-regular fa-circle-pause fs-20"></i>')},1e3*e)}function i(a){const e=parseInt(a,10);if(null!=e||""!=e||0!=e){A.empty(),_.empty();for(let a=1;a<=e;a++)_.append(`<div class="col-12"><fieldset class="p-2" id="sectionAnim${a}"><legend class="px-2 mb-0">Boton #${a}:</legend><select class="form-select animationsSelect selectList" data-add-action="#actionAnim${a}" name="areaAnim"><option selected hidden disabled>Animacion:</option></select><div class="row mt-4"><div class="col-4 col-md-4 mb-4 mb-md-0"><div data-mdb-input-init class="form-outline"><input type="number" id="areaTime${a}" data-anim-btn="#actionAnim${a}" name="areaTime" max="10" min="1" value="2" class="form-control text-end" /><label class="form-label" for="areaTime${a}">Duracion: (s)</label></div></div><div class="col-4 col-md-4"><div data-mdb-input-init class="form-outline"><input type="number" id="areaHeight${a}" data-anim-btn="#actionAnim${a}" name="areaHeight" min="1" max="${m}" value="1" class="form-control text-end" /><label class="form-label" for="areaHeight${a}">Alto:</label></div></div><div class="col-4 col-md-4"><div data-mdb-input-init class="form-outline"><input type="number" id="areaWidth${a}" data-anim-btn="#actionAnim${a}" name="areaWidth" min="1" max="${d}" value="1" class="form-control text-end" /><label class="form-label" for="areaWidth${a}">Largo:</label></div></div></div></fieldset></div>`),A.append(`<button type="button" id="actionAnim${a}" class="item play-anim-btn d-flex justify-content-center align-items-center fs-20" disabled>${a}</button>`),$("[data-mdb-input-init]").each(function(){new mdb.Input(this)});$(".animationsSelect").on("change",function(){const a=$(this).attr("data-add-action"),e=$(this).val();$(a).attr("data-animation",e),$(a).removeAttr("disabled")}),$('input[name="areaHeight"]').on("input",function(){if($("#modelAreas").is(":checked")){const a=parseInt($(this).val(),10),e=$(this).attr("data-anim-btn");$(e).removeClass(function(a,e){return(e.match(/(^|\s)grid-row_span\S+/g)||[]).join(" ")}),$(e).addClass(`grid-row_span-${a}`)}}),$('input[name="areaWidth"]').on("input",function(){if($("#modelAreas").is(":checked")){const a=parseInt($(this).val(),10),e=$(this).attr("data-anim-btn");$(e).removeClass(function(a,e){return(e.match(/(^|\s)grid-col_span\S+/g)||[]).join(" ")}),$(e).addClass(`grid-col_span-${a}`)}}),$(".play-anim-btn").click(function(){let a=$(this).attr("data-animation"),e=$(this).attr("data-duration");n(a,e)}),t()}}function r(a=3,e=3){m=$("#row_areas").val(),d=$("#col_areas").val(),$("#model_areas").css({"--grid-row":m||a,"--grid-column":d||e})}function o(){const a=s.attr("data-settings-model"),e=5e3,t=new FormData;t.append("idSetings","2"),fetch(a,{method:"POST",body:t,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRFToken":formToken}}).then(a=>a.json()).then(a=>{function t(){if(a.animations){const e=a.animations;for(let a=0;a<e[0].length;a++){const t=e[0][a];$(`#sectionAnim${a+1} option[value="${t}"]`).attr("selected",!0),$(`#actionAnim${a+1}`).removeAttr("disabled").attr({"data-animation":t,"data-duration":e[1][a]}).addClass(`grid-row_span-${e[2][a]} grid-col_span-${e[3][a]}`),$(`#sectionAnim${a+1} #areaTime${a+1}`).attr("value",e[1][a]),$(`#sectionAnim${a+1} #areaHeight${a+1}`).attr("value",e[2][a]),$(`#sectionAnim${a+1} #areaWidth${a+1}`).attr("value",e[3][a])}}}0!=a.success?($("[data-range-val='#cameraHorizontal']").text(a.cameraOrbit[0]),$("[data-range-val='#cameraVertical']").text(a.cameraOrbit[1]),$("[data-range-val='#cameraDistance']").text(a.cameraOrbit[2]),$("#cameraHorizontal").attr("value",a.cameraOrbit[0]),$("#cameraVertical").attr("value",a.cameraOrbit[1]),$("#cameraDistance").attr("value",a.cameraOrbit[2]),s.attr("camera-orbit",`${a.cameraOrbit[0]}deg ${a.cameraOrbit[1]}deg ${a.cameraOrbit[2]}m`),a.gridAreas&&($("#num_areas").attr("value",a.gridAreas[0]),$("#row_areas").attr("value",a.gridAreas[1]),$("#col_areas").attr("value",a.gridAreas[2]),r(a.gridAreas[1],a.gridAreas[2])),setTimeout(()=>{a.gridAreas&&i(a.gridAreas[0]),setTimeout(()=>{t()},500)},1e3)):alertSToast("center",e,"warning",a.message)}).catch(a=>{console.error("üò• Error inesperado:",a),errorMessage=a.message||"Ocurri√≥ un error. Intente nuevamente. üò•",alertSToast("center",e+8e3,"error",errorMessage)})}const s=$("#asistent_model"),l=s.attr("animation-name");let c,d,m;s.on("load",()=>c=s[0].availableAnimations);const u=$("#cameraHorizontal"),p=$("#cameraVertical"),f=$("#cameraDistance");u.on("input",a),p.on("input",a),f.on("input",a),a(),listHDRIs=["rainforest_trail_1k","symmetrical_garden_02_1k","rogland_clear_night_1k",""],currentIndex=0,$("#changeScene").click(function(){localStorage.setItem("model_hdr",listHDRIs[currentIndex]),""==listHDRIs[currentIndex]?(s.attr("environment-image",""),s.attr("skybox-image","")):(s.attr("environment-image",`/media/hdri/${listHDRIs[currentIndex]}.hdr`),s.attr("skybox-image",`/media/hdri/${listHDRIs[currentIndex]}.hdr`)),currentIndex++,currentIndex>=listHDRIs.length&&(currentIndex=0)});const g=localStorage.getItem("model_hdr");""!=g&&(alertSToast("center",8e3,"info",g),console.log(g));const h=$("#pauseAnim");let v=!1;h.on("click",function(){v=!v,v?s[0].pause():s[0].play(),h.attr("title",v?"Activar Animaci√≥n":"Pausar Animaci√≥n").html(v?'<i class="fa-solid fa-circle-play fs-20"></i>':'<i class="fa-regular fa-circle-pause fs-20"></i>')});const b=$("#reloadModel"),A=$("#model_areas"),_=$("#areasAnimations"),x=$("#animationsSelect");let y=0;$("#fileInput").on("change",function(a){const t=a.target.files[0];if(t){const a=["glb","gltf"],n=t.name.split(".").pop().toLowerCase();if(!a.includes(n))return alertSToast("center",8e3,"error","Por favor proporciona un archivo tipo GLB o GLTF");const i=URL.createObjectURL(t);e(i)}}),b.on("click",function(){const a=$.trim($(this).data("model"));a&&e(a)}),$("#animationsSelect").on("change",function(){const a=$(this).val();a&&(s[0].animationName=a,v=!1,s[0].play(),h.attr("title","Pausar Animacion").html('<i class="fa-regular fa-circle-pause fs-20"></i>'))}),$("#num_areas").on("input",function(){const a=$("#num_areas").val();$("#modelAreas").is(":checked")&&i(a)}),$("#row_areas, #col_areas").on("input",r),o(),setTimeout(()=>{if(b.click(),$("#modelAreas").is(":checked")){var a=$("#modelAreas").data("btn_closed");$(a).toggleClass("show"),a.includes("slide")&&$(a).slideToggle("slow")}},500)});